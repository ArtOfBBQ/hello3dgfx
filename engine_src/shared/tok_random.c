#include "tok_random.h"

uint32_t random_seed = 0;
static int32_t random_sequence[RANDOM_SEQUENCE_SIZE] = {
    7654,24225,27992,18159,20634,15636,5558,31144,8709,22118,20922,9389,
    30361,10707,15619,11980,6984,7613,19899,5045,5080,5197,24123,26630,
    32019,10134,1597,20681,26118,30497,27601,20489,27155,24616,16182,32227,
    8929,26400,8864,26765,8742,19301,15984,1086,20579,22152,16234,31686,
    10124,29832,23158,9162,27504,1776,17923,6046,12294,18008,30303,4849,
    31249,5196,5965,28804,8080,24551,3379,22553,26221,7379,30179,27428,
    32452,4967,23032,7779,15943,4702,2306,7281,6369,906,22627,23595,
    1765,16917,10155,2366,11644,15219,3443,16362,2299,1898,7508,26329,
    17455,16522,26552,5972,20011,22895,9208,24648,8473,2043,23174,21866,
    2702,19598,12164,22011,29267,1460,31904,20223,20996,20597,22161,14322,
    17003,15009,16095,30832,7997,10085,17208,9379,12054,30183,25838,16193,
    16669,31696,17596,24426,14342,14051,6891,24382,28436,18703,2410,13319,
    7979,22560,1790,18405,5371,28420,23677,25475,24259,12494,12548,26911,
    14028,17559,21526,30714,9107,9993,2892,11658,25400,17230,26749,3542,
    8634,28128,15143,8091,11717,721,31483,1667,13440,25101,13038,11084,
    5531,7536,28621,7807,15034,30806,32073,22335,16690,27970,31685,6836,
    28470,5726,19771,30390,17044,15202,1817,9941,27995,11554,8481,32336,
    20068,21428,29374,23099,20693,31113,1857,26607,18265,11277,8877,2967,
    28051,6749,28975,8981,7086,7461,5647,18093,21463,24795,12242,21979,
    31216,366,18297,30334,29546,3020,7430,21867,25392,7187,22744,10196,
    27825,20527,24876,4300,20089,25211,6518,30547,26040,15135,29276,61,
    12774,12669,30262,13961,25413,30946,31147,13145,30863,19721,683,27680,
    16253,4375,30959,15875,26180,25365,3298,24558,28567,12718,7943,19376,
    11628,11529,24954,32648,10933,896,30036,15868,31737,23854,2473,21143,
    14070,784,10605,20971,21510,3590,21410,7541,16704,29540,11500,11402,
    2976,14274,13202,25322,18735,11217,3329,31941,18112,5011,6593,8028,
    18692,17105,15368,30080,15936,24999,28981,15434,14889,2250,2290,10873,
    29772,15955,14892,8141,20658,22725,6023,32750,28560,29212,28900,20342,
    23077,6439,27302,22935,5088,14195,576,4902,8511,4192,3574,11204,
    26910,21789,26000,28805,3297,16031,1170,11060,5346,13965,20860,28533,
    14265,13595,25470,6498,25328,18903,21049,6789,26068,15083,30702,28019,
    19604,29364,17849,25940,32594,32479,21977,6436,18323,23684,24585,16124,
    2175,6746,3217,9501,25460,23128,6081,6986,24591,27735,17175,17606,
    19318,10558,16380,21539,15311,15982,1746,23579,18486,8275,10758,15390,
    18263,20003,829,6385,13959,7823,12405,14441,2143,18599,32671,10998,
    29717,22470,19477,15609,13190,26105,28052,13312,10763,7522,17356,27259,
    30043,8727,19219,31665,8008,7548,29850,13996,31591,29810,19063,16556,
    11381,20977,25236,10029,14518,29518,32415,14516,26735,26497,4664,4732,
    22571,24564,4516,10957,24823,12624,16618,2794,1866,16494,8907,23004,
    5322,3782,13797,575,8117,26534,2167,25301,13741,17874,10228,29332,
    10643,20790,28909,26423,5278,3696,8239,2771,6641,1829,17162,28483,
    24414,31801,19285,21303,16848,26134,32586,22064,30610,20660,3064,31076,
    4574,28774,16257,1757,9862,20357,23704,7881,15987,25310,15047,17161,
    31757,7758,136,5546,17511,28682,7951,3305,19748,16416,24791,8001,
    9862,7186,20103,31585,655,32303,23180,14944,8973,15671,11720,24164,
    7623,16501,20764,10204,13976,20270,32518,30353,2870,22731,2398,24746,
    25226,9695,21775,32660,9378,22446,4824,24251,16182,20301,29088,12669,
    14815,11315,18016,3658,16329,8558,24744,30376,24456,29584,5754,12907,
    2622,2538,5947,10730,27768,3266,345,2456,13950,21826,2598,15264,
    5697,30801,18144,1748,27306,24328,32320,11674,21923,25070,4971,17373,
    20374,24288,30848,27707,26675,10910,16045,857,21300,3183,17023,31069,
    17329,4371,5219,8248,12688,20321,28646,12122,24621,2838,23896,6388,
    12236,16887,2617,21285,26743,27947,32038,24484,31666,4895,14907,27471,
    6061,23648,32556,24826,28809,32262,5475,25313,17247,27412,25456,7833,
    16071,927,18613,9971,7146,11543,4420,11535,15119,25986,7843,20279,
    18795,19175,31360,30137,15025,10221,8865,12974,28936,14421,16052,17115,
    6368,14366,23450,2850,7537,6693,28472,1021,30613,10794,12413,1412,
    19554,13404,20935,1051,25183,20814,1127,13960,14802,5254,17575,16368,
    9663,26248,10625,5268,20004,28608,27567,18949,19667,14897,24070,6212,
    25355,6578,15741,6210,2996,23772,15577,10790,10991,21731,20009,11063,
    12077,6698,9532,15120,20267,31139,15907,846,17432,29897,25404,9581,
    1393,6515,3794,10860,7108,3028,2617,24661,12382,18999,15578,9339,
    26460,24034,31970,17186,19186,3947,6660,13112,3278,4066,5635,8250,
    23901,22687,4830,21847,13730,5786,8520,32008,19003,2150,31999,7250,
    3213,6713,4374,5839,10315,27595,23802,27427,17615,11998,19537,27014,
    14162,25774,21082,26797,2494,32120,19253,8456,25991,14619,1999,16006,
    29516,20233,7446,1300,11113,16564,21900,6626,9777,1144,15708,30808,
    11235,32732,26920,22019,15290,19519,6341,20928,16100,2014,31041,28809,
    14657,22116,6449,19467,23869,25082,22601,29698,20425,21411,4732,881,
    2392,5316,6020,19856,27773,15597,14548,14068,12416,18129,13057,24512,
    9723,3244,139,7758,3293,18023,32545,19675,22670,9537,12953,2255,
    9191,5228,2653,19969,22339,15357,5055,8252,2009,31897,14032,10166,
    19825,9850,6462,24821,2121,13975,7402,77,20945,10296,29104,23164,
    2401,28687,5674,29274,21497,99,23378,27064,10471,14614,30550,25796,
    19082,24094,16676,16929,161,18572,31253,20986,21080,30939,14271,22768,
    22778,31230,12591,2726,18295,13718,30120,30927,20288,9481,30956,23723,
    8614,20409,11115,20735,5146,17685,5631,1433,16806,26096,18699,16352,
    18994,20046,10565,30434,7062,24136,6462,16226,6167,16049,8449,32395,
    30074,5383,4334,21007,22691,21167,13037,31031,17349,31573,4892,20848,
    28776,18532,831,29253,5443,13253,6219,19442,29006,11166,5308,22652,
    16494,22497,28982,30672,7615,30742,20463,11189,22002,15149,15798,23119,
    15989,9366,3446,6722,29293,15737,4743,27814,21315,25643,12845,1575,
    12279,5378,4111,18072,24720,3541,27766,22930,31529,26019,4840,12807,
    15512,5304,2811
};

int32_t tok_rand(void) {
    random_seed++;
    if (random_seed >= RANDOM_SEQUENCE_SIZE) {
        random_seed = 0;
    }
    
    #ifndef RANDOM_IGNORE_ASSERTS
    assert(random_sequence[random_seed] >= 0);
    #endif
    
    return random_sequence[random_seed];
}

int32_t tok_rand_at_i(const uint64_t index) {
    #ifndef RANDOM_IGNORE_ASSERTS
    assert(index < RANDOM_SEQUENCE_SIZE);
    #endif
    
    #ifndef RANDOM_IGNORE_ASSERTS
    assert(random_sequence[random_seed] >= 0);
    #endif
    return random_sequence[index];
}

void shuffle_array(
    void * array,
    const uint32_t array_size,
    const uint32_t element_size)
{
    char * char_array = (char *)array;
    
    uint32_t start_i = 0;
    for (
        uint32_t size_left = array_size;
        size_left > 1;
        size_left--)
    {
        uint32_t swap_i = start_i +
            ((uint32_t)tok_rand() % size_left) * element_size;
        
        // swap element_size bytes starting at start_i with
        // element_size bytes starting at swap_i;
        char swap;
        for (uint32_t _ = 0; _ < element_size; _++) {
            swap = *(char_array + start_i + _);
            *(char_array + start_i + _) = *(char_array + swap_i + _);
            *(char_array + swap_i + _) = swap;
        }
        
        start_i += element_size; 
    }
}
